## 3.2 购物车

### 术语及概念

购物车是电商平台与用户交互的重要模块。电商平台要实现产品的购买，需要提供一个临时存放用户选购商品的地方。
当用户选好所需商品以后，就可以进入结账流程和下达订单了。
而这个联系着选购动作和结账行为的中间功能就是购物车。
购物车保存的信息是产品。顾客可以随意往购物车添加商品、删除商品，修改数量，也可随时通过各种入口查看购物车信息。
购物车（Shopping Cart）是一般的俗称，对于一些衣物服饰类站点，购物车也被称为购物篮（Shopping Bag），只是为了对该行业更加形象一些。
设计优秀的购物车功能，对于提高购物车转换率，增加销售非常有帮助。

![Shop Cart](http://ols55jaqt.bkt.clouddn.com/img/png/shopcart.png)
 
### 功能规划

 购物车页面（Your Shopping Cart）是购物车的主页面，包含购物车的所有功能。在平台上应有多个访问入口以便进入此页面。
 
#### 加入购物车
加入购物车阿里侧键往购物车内添加产品信息的主要途径。一般有几个途径：

* 从「产品页面」加入（或产品列表），显示「加入购物车」图标按钮
    这种方式特点是需要选择SKU规格，
     如果SKU规格信息较多和复杂，显得产品列表太臃肿
* 从「暂存架」（Save For Later）加入
    有时也称为「收藏夹」，这并不准确，收藏夹的功能比暂存架要复杂，关注点也不一样。
    收藏夹会提供更为复杂的分组、共享、信息提醒功能。
    在国外的电商系统中，Buy later 就是这种功能的体现，在Buy later列表中看到的商品对应的功能是Buy Now。
* 批量加入购物车
    主要是为历史订单提供的功能。
    当订单状态为「完成」后，允许顾客将该订单的所有产品加入购物车，即「再次购买」，
    一般情况下不必选择SKU规格，沿用原先订单里的规格，但是当某种规格SKU缺货或下架，则需要提供在购物车中更改对该产品的SKU规格选择。
 
 在加入购物车后，会弹出一个信息提示，这个信息提示有几种形式：1）重复小购物车的信息，并提供View Cart和Checkout按钮；2）弹出层，包含当前加入购物车的商品。
    
 #### 购物车自身功能

* 查看购物车
    - 按商家分组，参考京东、淘宝；
    - 按促销活动分组，即满足某个促销活动的产品设为一组，方便顾客查看当前选购是否满足活动的生效条件，参考京东
 * 修改数量
 * 暂存架（Save For Later）
 * 从暂存架移回：将暂存夹的商品移回购物车。
 * 移除购物车产品
 * 清空购物车
 * 修改规格：这个属于比较高级的功能，对于选购商品需要选择规格的站点 才需要提供这个功能，而点击编辑时，有两种处理方式：1）跳转回产品详细。2）直接在购物车通过Ajax调出编辑页面。
 
 #### 结账
 
 * 购物车内的产品折扣、分组促销规则、整体促销规则，这是归属促销模块的功能，由该模块提供的接口，在购物车模块内调用计算获得数据；
 * 对结账的支持
    — 总价计算，包括销售价总价，折后价总价等
    - 支持整体结账（这是默认的功能）
    - 支持部分结账，如选择一个商家的产品，一个组的商品（如某个促销活动的一组），指定的若干产品进行结账
 * 对下达订单的支持，根据该次结账所选择的商品，生成订单后，需要从购物车获取选购信息，并将这些产品从购物车移除。
    

#### 关联推荐

关联推荐并不是购物车本身功能，归属产品关联推荐模块，在购物车中，根据不同业务的上下文在相关的位置进行调用和显示。
在不同的视图中，根据上下文推荐产品（如：Also Like/Also Buy...），即在购物车内根据当前购物车的商品动态的查询出和这些商品关联的促销推荐等，是提高销量和购物车转换率的有效手段。
有3种推荐类型： 根据其它顾客的购买行为、浏览和收藏来推荐；根据产品的交叉销售来推荐；根据产品的向上（追加）销售推荐。

**在购物车页面**

   根据行为推荐
   
   * 显示「Also Buy」，其它顾客的购买行为；
   
   * 显示「Also View」，其它顾客的浏览行为；
   
   * 显示当前顾客的历史浏览情况。
    
   交叉销售，根据购物车内的产品野德交叉销售的推荐，主要针对最近加入购物车的几个产品，加入时间靠后的产品权重较小。
   
   向上销售，原来同上，但在购物车中做这样的推荐，需要斟酌，因其会推迟顾客结账的时间，让其在多个产品间犹豫不决，向上销售更适合在产品详情页面进行推荐。

**在加入购物车的成功提示视图**

    针对当前加入购物车的产品，一般采用交叉销售的关联推荐方式，在顾客确定了对当前产品的购买意向后，向其推荐相关联的。
    
    
**在迷你购物画的独立视图**

    同上采用交叉销售的关联推荐方式，因采用独立的页面，推荐形式、产品可以更多。
    
    ![mini_cart](http://ols55jaqt.bkt.clouddn.com/img/png/mini_shopcart.png ==400x800)
    <img src= "http://ols55jaqt.bkt.clouddn.com/img/png/mini_shopcart.png" width="400">
    
#### 结账若干提前功能   
    
 根据加入购物车的当前商品和购物车内的商品进行动态计价，让客户在进入结账前了解需要支付的运费。一般订单的金额包括：商品的折后金额、运费和包装费，而包装往往是可选的，所以在购物车提供优惠券使用和运费选择就相当让客户在未结账时就了解了整张订单的总金额，有利于做出购买决定。
   
 * 积分使用：在购物车阶段就将积分进行使用（并不是实际扣除，只有在下达订单时才真正扣除）
 * 优惠券（含礼品卡券）使用：在购物车中输入优惠券号码 并不会真正使用，但会在页面上显示使用优惠券后的折扣价格，让顾客在结账前可以看到购物车金额的改变（并不是实际使用，只有在下达订单时才真正使用）
 * 运费估算：运费和运输方式、产品及区域相关，购物车内的商品（已经有重量和体积），顾客在购物车内选择运输方式和区域，即可计算出运费。 如果无需选择运输方式（或按默认方式），则选择地区或目标配送地址后运费可以计算出来。
 
#### 策略功能
 
 策略功能指是的提高购物车转化率所设计的功能。实际实施中，可以根据自身特点，挖掘更多功能。
 
 * 库存相关，库存提醒，剩余多少件，对于库存低于某个警戒线的产品，直接在购物车内显示库存描述（比如库存紧缺）或实际库存数量（只剩3件）等。
 对顾客的心理形成压力，加速结账行为的决定。
 * 促销活动时效，某促销活动剩余多少时间，提醒顾客尽快下单享受优惠，到期时间可以描述精确或相对精确，比如在10小时36分结束
 * 促销生效条件，在购物车内某些产品在某个促销活动内，但差一些金额或数量，还未达到生效条件，则在该组中显示生效条件，有利增加订单金额，如：满200减40，现在还差15元
  
#### 购物车的存储
采用以下几种手段用于保存购物车的数据。
1. Cookie：可以只保存购物车ID，也可以保存完整的购物车数据（JSON），这样只要在同一台的客户端进行访问，无需登录就可查看购物车数据。优点是性能好，缺点是安全性低，
且当客户端清空信息时会丢失数据，换台机器也看不到上次访问的网站时所加入的购物车的产品信息。
2. 使用Session：
3. 基于DB，可以持久化处理，用户清空机器或更换机器均可以看到网站加入购物画的产品。当在线用户多，频繁更新数据库里，性能有一些影响。
4. 基于Redis或Memcached
现在通常的方法, 采用以上手段混合使用，数据库做持久化，在会话期间，当购物车被读取放到使用Session中，
只要购物车没有发生改变，则下次访问购物车页面时，从Session读取即可，访问效率提高不少，
在客户端记录购物车ID，在顾客下次使用该客户端访问网站时，未登录之前，就可以根据该ID从数据库查询获得购物车数据。
也可以在Cookie保存购物车ID，总数量，金额合计
> 这里的东西只是产品分思路，要重新设计。

#### 购物车结账跟踪
当顾客点击「结账」时，即存储一条购物车结账跟踪记录，以当前会话的SessionID为唯一的键，即只要在当前Session中完成订单下达，就算完成了一次购物车转化，
如果在当前Session中没有完成订单下达，则算一次购物车遗弃。
只要SessionID相同，中间退出结账修改购物车，选购其它产品，不算购物车遗弃。

### 部分用例说明

#### 购物车顾客基本用例

* 【UC】加入购物车：选择产品的规格后，获得对应产品SKU的ID，加上数量和价格，添加到购物车中，如果购物车已经存在该产品SKU，则做合并更新处理，并同时更新购物车本身的统计信息。
* 【UC】加入购物车-弹出式提示和推荐：完成「加入购物车」动作后，根据配置（弹出信息或跳转页面），到弹出式提示页面。包括显示成功加入购物车信息，以及根据当前产品SKU进行关联推荐。
关联推荐通过调用产品关联推荐模块的接口实现，获得推荐的产品组合。
* 【UC】加入购物车-迷你推荐购物车独立推荐页：应提供页面层的组件封装（tag、js），调用即可。
* 【UC】批量加入购物车
* 【UC】浏览购物车
    - 按商家分组：针对多商家系统
    - 显示赠品：按促销活动进行显示，如果针对单个产品赠品，凡是该产品作为一个独立分组
    - 显示库存：需要选择区域，根据区域管理的仓库进行库存查询
* 【UC】修改产品数量： 更新购物车项目，如果数量为0，则调用移除产品方法，并同时更新购物车统计信息
* 【UC】移除产品：删除购物车项目（商品），更新购物车统计信息
* 【UC】清空购物车：删除购物车内所有项目，更新购物车统计信息
* 【UC】移到暂存架：更新购物车的项目是否暂存，即这里有个标记位，设为Y（True）更新购物车统计信息
* 【UC】从暂存架移回：更新购物车项目暂存标记位为N(False)，更新购物车统计信息

#### 购物车顾客扩展用例

* 【UC】选择区域： 在购物车中保存所选区域，扩展用例 ：
    -【UC】查询库存信息（查询关联仓库ID），
    -【UC】计算运费：如果有多种运输方式，则需要选择（或采用默认的方式计算），然后根据「区域」+「产品」（重量或体积）+「物流」方式计算出运费
* 使用优惠券（礼品卡）：使用成功后更新购物车价格，并将优惠券存储在购物车促销列表中，但该优惠装好真正设置已使用状态，则在下订单后
* 使用积分：同上
* 浏览购物车：基于基本用例的购物车浏览，增加若干功能，包括：
    - 产品关联推荐，调用相关模块接口和服务实现
    - 按促销活动分组，购物车发生变更时，调用促销活动模块获得相关的数据存储，然后根据数据读取进行分组。
    - 促销信息提示，根据促销活动相关数据显示
* 选择赠品
    - 赠品可以是免费的，也可以是付费的（一般为特价）
    - 当符合赠品相关的促销活动条件时，该分组显示「选择赠品」供选择


